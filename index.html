<!DOCTYPE html>
<html>
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
  </head>
  <body>
    <script type="module">
      import init, { WorkProof } from './pkg/spike_work_proof.js';

      let lastTime = Date.now();
      function print(...args) {
        const now = Date.now();
        const diff = now - lastTime;
        lastTime = now;
        for (const arg of args) {
          document.body.appendChild(document.createTextNode(diff + ': ' + arg));
          document.body.appendChild(document.createElement("br"));
        }
      }

      async function run() {
        print("initializing...");

        await init();

        const seed = crypto.getRandomValues(new Uint8Array(20));
        const hash = crypto.getRandomValues(new Uint8Array(32));

        print("generating WorkProof instance...");
        const [ wp ] = WorkProof.init(1, seed, hash);

        print("generating the next proof...");
        const dif = wp.next();
        print(`got: ${dif}`);

        print("free memory...");

        wp.free();

        print("done.");
      }

      run();
    </script>
  </body>
</html>
